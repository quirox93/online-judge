---
const req = Astro.request;
import Layout from "../layouts/Layout.astro";
---

<script is:inline>
async function parseMagicLink(req) {
    const vals = window.location.hash
        .substring(1)
        .split("&")
        .map((kv) => kv.split("="));
    const hashParameters = new Map(vals);
    const token = JSON.stringify({
        currentSession: Object.fromEntries(hashParameters),
    });
    localStorage.setItem("supabase.auth.token", token);

    window.location.replace("/");
}
parseMagicLink();
</script>
